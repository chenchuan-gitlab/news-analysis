<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.news.analysis.dao.api.NewsAnalysisMapper">
    <resultMap id="BaseResultMap" type="java.util.Map">
        <result column="type" property="type"/>
        <collection property="list" javaType="java.util.ArrayList" ofType="java.util.Map">
            <result column="time" property="time"/>
            <result column="total" property="total"/>
        </collection>
    </resultMap>

    <select id="getDataList" resultType="java.util.Map">
        SELECT
	        wc.NEWS_TYPE AS type,
	        ni.total AS total
        FROM
	        website_config wc
	        LEFT JOIN ( SELECT NEWS_TYPE AS type, COUNT( 1 ) AS total FROM news_info WHERE SITE_NAME=#{siteName} GROUP BY NEWS_TYPE ) ni ON wc.NEWS_TYPE = ni.type
	        WHERE wc.WEBSITE=#{siteName}
    </select>

    <select id="getTodayTotal" resultType="java.util.Map">
        SELECT
	        wc.NEWS_TYPE AS type,
	        ni.total AS total
        FROM
	        website_config wc
	        LEFT JOIN (
	        SELECT NEWS_TYPE AS type, COUNT( 1 ) AS total FROM news_info WHERE TIME BETWEEN #{startTime} AND #{endTime} AND SITE_NAME=#{siteName} GROUP BY NEWS_TYPE ) ni
	        ON wc.NEWS_TYPE = ni.type
            WHERE wc.WEBSITE=#{siteName}
    </select>
    <select id="getMonthTotal" resultMap="BaseResultMap">
        SELECT
            wc.NEWS_TYPE AS type,
            ni.dates AS time,
            ni.total AS total
        FROM
            website_config wc
            LEFT JOIN (
            SELECT
                NEWS_TYPE AS type,
                DATE_FORMAT( TIME, '%Y-%m-%d' ) AS dates,
                COUNT( 1 ) AS total
            FROM
                news_info
            WHERE
                TIME BETWEEN #{startTime}
                AND #{endTime}
                AND SITE_NAME=#{siteName}
            GROUP BY
                NEWS_TYPE,
            dates
            ) ni ON wc.NEWS_TYPE = ni.type
            WHERE wc.WEBSITE=#{siteName}
    </select>
</mapper>